# This config was automatically generated from your source code
# Stacks detected: cicd:github-actions:.github/workflows,deps:python:app
version: 2.1
orbs:
  python: circleci/python@2
jobs:
  test-python:
    # Install dependencies and run tests
    docker:
      - image: cimg/python:3.8-node
    working_directory: ~/project/app
    steps:
      - checkout:
          path: ~/
      - python/install-packages
      - run:
          name: Run tests
          command: pylint --output-format=parseable --disable=E401 --fail-under=5 app/app.py app/wsgi.py app/modules/backend.py
      # - store_test_results:
      #     path: junit.xml
  build_docker:
    docker:
      - image: docker:20.10
      environment:
        DOCKER_USER: devops45of
        DOCKER_PASS: ${{ secrets.DOCKER_PASSWD }}
    steps:
      - checkout
      - build_docker:
      - run: | 
        dokcer build -t devops45of/app:1.$CIRCLE_BUILD_NUM -t devops45of/app:latest .
        docker push devops45of/app:1.$CIRCLE_BUILD_NUM 

workflows:
  build-and-test:
    jobs:
      - test-python
      - build_docker:
          requires:
            - test-python
